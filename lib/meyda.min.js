"use strict";!function(a,b){function h(a){return a.forEach||(a.forEach=function(a){var b,c=this.length;for(b=0;c>b;b++)a(this[b],b,c)}),a}var f,g,c=Float32Array,d=Math.sqrt,e=function(a){return Math.pow(a,2)};a.isComplexArray=f=function(a){return a!==b&&a.hasOwnProperty!==b&&a.hasOwnProperty("real")&&a.hasOwnProperty("imag")},a.ComplexArray=g=function(a,b){f(a)?(this.ArrayType=a.ArrayType,this.real=new this.ArrayType(a.real),this.imag=new this.ArrayType(a.imag)):(this.ArrayType=b||c,this.real=new this.ArrayType(a),this.imag=new this.ArrayType(this.real.length)),this.length=this.real.length},g.prototype.toString=function(){var a=[];return this.forEach(function(b){a.push("("+b.real.toFixed(2)+","+b.imag.toFixed(2)+")")}),"["+a.join(",")+"]"},g.prototype.map=function(a){var b,c=this.length,d={};for(b=0;c>b;b++)d.real=this.real[b],d.imag=this.imag[b],a(d,b,c),this.real[b]=d.real,this.imag[b]=d.imag;return this},g.prototype.forEach=function(a){var b,c=this.length,d={};for(b=0;c>b;b++)d.real=this.real[b],d.imag=this.imag[b],a(d,b,c)},g.prototype.conjugate=function(){return new g(this).map(function(a){a.imag*=-1})},g.prototype.magnitude=function(){var a=new this.ArrayType(this.length);return this.forEach(function(b,c){a[c]=d(e(b.real)+e(b.imag))}),h(a)}}("undefined"==typeof exports&&(this.complex_array={})||exports),!function(a,b){function i(a){return b.isComplexArray(a)&&a||new c(a)}function j(a,b){var c=a.length;return c&c-1?k(a,b):l(a,b)}function k(a,b){var i,k,l,m,n,p,q,r,s,t,u,v,w,x,e=a.length;if(1===e)return a;for(l=new c(e,a.ArrayType),r=o(e),s=e/r,t=1/f(r),u=new c(s,a.ArrayType),k=0;r>k;k++){for(i=0;s>i;i++)u.real[i]=a.real[i*r+k],u.imag[i]=a.imag[i*r+k];for(s>1&&(u=j(u,b)),p=g(2*d*k/e),q=(b?-1:1)*h(2*d*k/e),m=1,n=0,i=0;e>i;i++)w=u.real[i%s],x=u.imag[i%s],l.real[i]+=m*w-n*x,l.imag[i]+=m*x+n*w,v=m*p-n*q,n=m*q+n*p,m=v}for(i=0;e>i;i++)a.real[i]=t*l.real[i],a.imag[i]=t*l.imag[i];return a}function l(a,b){var f,i,j,k,l,m,o,p,q,r,s,t,u,v,w,x,y,c=a.length;for(j=n(a),k=j.real,l=j.imag,y=1;c>y;){for(p=g(d/y),q=(b?-1:1)*h(d/y),f=0;c/(2*y)>f;f++)for(m=1,o=0,i=0;y>i;i++)s=2*f*y+i,t=s+y,u=k[s],v=l[s],w=m*k[t]-o*l[t],x=o*k[t]+m*l[t],k[s]=e*(u+w),l[s]=e*(v+x),k[t]=e*(u-w),l[t]=e*(v-x),r=m*p-o*q,o=m*q+o*p,m=r;y<<=1}return j}function m(a,b){for(var c=0;b>1;)c<<=1,c+=1&a,a>>=1,b>>=1;return c}function n(a){var d,e,b=a.length,c={};for(e=0;b>e;e++){var f=m(e,b);c.hasOwnProperty(e)||c.hasOwnProperty(f)||(d=a.real[f],a.real[f]=a.real[e],a.real[e]=d,d=a.imag[f],a.imag[f]=a.imag[e],a.imag[e]=d,c[e]=c[f]=!0)}return a}function o(a){for(var b=3,c=f(a);c>=b;){if(0===a%b)return b;b+=2}return a}var c=b.ComplexArray,d=Math.PI,e=Math.SQRT1_2,f=Math.sqrt,g=Math.cos,h=Math.sin;c.prototype.FFT=function(){return j(this,!1)},a.FFT=function(a){return i(a).FFT()},c.prototype.InvFFT=function(){return j(this,!0)},a.InvFFT=function(a){return i(a).InvFFT()},c.prototype.frequencyMap=function(a){return this.FFT().map(a).InvFFT()},a.frequencyMap=function(a,b){return i(a).frequencyMap(b)}}("undefined"==typeof exports&&(this.fft={})||exports,"undefined"==typeof require&&this.complex_array||require("./complex_array"));var Meyda=function(a,b,c,d){var i,e=this,f=c?c:256,g=b,h=!1,j=function(a,b){for(var c=0,d=0,e=0;e<b.length;e++)c+=Math.pow(e,a)*Math.abs(b[e]),d+=b[e];return c/d},k=function(a){for(;0==a%2&&a>1;)a/=2;return 1==a};e.windowingFunction="hanning",e.hanning=new Float32Array(c);for(var l=0;c>l;l++)e.hanning[l]=.5-.5*Math.cos(2*Math.PI*l/(c-1));e.hamming=new Float32Array(c);for(var l=0;c>l;l++)e.hamming[l]=.54-.46*Math.cos(2*Math.PI*(l/c-1));if(e.windowing=function(a,b){var c=new Float32Array(a.length);if("hanning"==b)for(var d=0;d<a.length;d++)c[d]=a[d]*e.hanning[d];else if("hamming"==b)for(var d=0;d<a.length;d++)c[d]=a[d]*e.hamming[d];else if("blackman"==b)for(var d=0;d<a.length;d++)c[d]=a[d]*e.blackman[d];return c},e.setSource=function(a){g=a,g.connect(window.spn)},k(f)&&a)return e.featureInfo={buffer:{type:"array"},rms:{type:"number"},energy:{type:"number"},zcr:{type:"number"},complexSpectrum:{type:"multipleArrays",arrayNames:{1:"real",2:"imag"}},amplitudeSpectrum:{type:"array"},powerSpectrum:{type:"array"},spectralCentroid:{type:"number"},spectralFlatness:{type:"number"},spectralSlope:{type:"number"},spectralRolloff:{type:"number"},spectralSpread:{type:"number"},spectralSkewness:{type:"number"},spectralKurtosis:{type:"number"},loudness:{type:"multipleArrays",arrayNames:{1:"total",2:"specific"}},perceptualSpread:{type:"number"},perceptualSharpness:{type:"number"},mfcc:{type:"array"}},e.featureExtractors={buffer:function(a,b){return b.signal},rms:function(a,b){for(var c=0,d=0;d<b.signal.length;d++)c+=Math.pow(b.signal[d],2);return c/=b.signal.length,c=Math.sqrt(c)},energy:function(a,b){for(var c=0,d=0;d<b.signal.length;d++)c+=Math.pow(Math.abs(b.signal[d]),2);return c},complexSpectrum:function(a,b){return b.complexSpectrum},spectralSlope:function(a,b){for(var c=0,d=0,e=new Float32Array(b.ampSpectrum.length),f=0,g=0,h=0;h<b.ampSpectrum.length;h++){c+=b.ampSpectrum[h];var i=h*b.audioContext.sampleRate/a;e[h]=i,f+=i*i,d+=i,g+=i*b.ampSpectrum[h]}return(b.ampSpectrum.length*g-d*c)/(c*(f-Math.pow(d,2)))},spectralCentroid:function(a,b){return j(1,b.ampSpectrum)},spectralRolloff:function(a,b){for(var c=b.ampSpectrum,d=b.audioContext.sampleRate/(2*(c.length-1)),e=0,f=0;f<c.length;f++)e+=c[f];for(var g=.99*e,h=c.length-1;e>g&&h>=0;)e-=c[h],--h;return(h+1)*d},spectralFlatness:function(a,b){for(var c=b.ampSpectrum,d=0,e=0,f=0;f<c.length;f++)d+=Math.log(c[f]),e+=c[f];return Math.exp(d/c.length)*c.length/e},spectralSpread:function(a,b){var c=b.ampSpectrum;return Math.sqrt(j(2,c)-Math.pow(j(1,c),2))},spectralSkewness:function(a,b){var d=b.ampSpectrum,e=j(1,d),f=j(2,d),g=j(3,d),h=2*Math.pow(e,3)-3*e*f+g,i=Math.pow(Math.sqrt(f-Math.pow(e,2)),3);return h/i},spectralKurtosis:function(a,b){var c=b.ampSpectrum,d=j(1,c),e=j(2,c),f=j(3,c),g=j(4,c),h=-3*Math.pow(d,4)+6*d*e-4*d*f+g,i=Math.pow(Math.sqrt(e-Math.pow(d,2)),4);return h/i},amplitudeSpectrum:function(a,b){return b.ampSpectrum},zcr:function(a,b){for(var c=0,d=0;d<b.signal.length;d++)(b.signal[d]>=0&&b.signal[d+1]<0||b.signal[d]<0&&b.signal[d+1]>=0)&&c++;return c},powerSpectrum:function(a,b){for(var c=new Float32Array(b.ampSpectrum.length),d=0;d<c.length;d++)c[d]=Math.pow(b.ampSpectrum[d],2);return c},loudness:function(a,b){for(var c=new Float32Array(b.ampSpectrum.length),d=24,e=new Float32Array(d),f=0,g=b.ampSpectrum,h=new Int32Array(d+1),i=0;i<c.length;i++)c[i]=i*b.audioContext.sampleRate/a,c[i]=13*Math.atan(c[i]/1315.8)+3.5*Math.atan(Math.pow(c[i]/7518,2));h[0]=0;for(var j=c[b.ampSpectrum.length-1]/d,k=1,i=0;i<b.ampSpectrum.length;i++)for(;c[i]>j;)h[k++]=i,j=k*c[b.ampSpectrum.length-1]/d;h[d]=b.ampSpectrum.length-1;for(var i=0;d>i;i++){for(var l=0,m=h[i];m<h[i+1];m++)l+=g[m];e[i]=Math.pow(l,.23)}for(var i=0;i<e.length;i++)f+=e[i];return{specific:e,total:f}},perceptualSpread:function(a,b){for(var c=b.featureExtractors.loudness(a,b),d=0,e=0;e<c.specific.length;e++)c.specific[e]>d&&(d=c.specific[e]);var f=Math.pow((c.total-d)/c.total,2);return f},perceptualSharpness:function(a,b){for(var c=b.featureExtractors.loudness(a,b),d=c.specific,e=0,f=0;f<d.length;f++)e+=15>f?(f+1)*d[f+1]:.066*Math.exp(.171*(f+1));return e*=.11/c.total},mfcc:function(b,c){for(var d=c.featureExtractors.powerSpectrum(b,c),e=function(a){var b=1125*Math.log(1+a/700);return b},f=function(a){var b=700*(Math.exp(a/1125)-1);return b},g=26,h=new Float32Array(g+2),i=new Float32Array(g+2),j=0,k=a.sampleRate/2,l=e(j),m=e(k),n=m-l,o=n/(g+1),p=Array(g+2),q=0;q<h.length;q++)h[q]=q*o,i[q]=f(h[q]),p[q]=Math.floor((b+1)*i[q]/a.sampleRate);for(var r=Array(g),s=0;s<r.length;s++){r[s]=Array.apply(null,new Array(b/2+1)).map(Number.prototype.valueOf,0);for(var q=p[s];q<p[s+1];q++)r[s][q]=(q-p[s])/(p[s+1]-p[s]);for(var q=p[s+1];q<p[s+2];q++)r[s][q]=(p[s+2]-q)/(p[s+2]-p[s+1])}for(var t=new Float32Array(g),q=0;q<t.length;q++){t[q]=0;for(var s=0;b/2>s;s++)r[q][s]=r[q][s]*d[s],t[q]+=r[q][s];t[q]=Math.log(t[q])}for(var u=Math.PI/g,v=1/Math.sqrt(g),w=Math.sqrt(2/g),x=13,y=new Float32Array(x*g),q=0;x>q;q++)for(var s=0;g>s;s++){var z=q+s*x;y[z]=0==q?v*Math.cos(u*(q+1)*(s+.5)):w*Math.cos(u*(q+1)*(s+.5))}for(var A=new Float32Array(x),u=0;x>u;u++){for(var B=0,C=0;g>C;C++){var z=u+C*x;B+=y[z]*t[C]}A[u]=B/x}return A}},window.spn=a.createScriptProcessor(f,1,1),spn.connect(a.destination),window.spn.onaudioprocess=function(a){var b=a.inputBuffer.getChannelData(0);e.signal=b;var c=e.windowing(e.signal,e.windowingFunction),g=new complex_array.ComplexArray(f);g.map(function(a,b){a.real=c[b]});var j=g.FFT();e.complexSpectrum=j,e.ampSpectrum=new Float32Array(f/2);for(var k=0;f/2>k;k++)e.ampSpectrum[k]=Math.sqrt(Math.pow(j.real[k],2)+Math.pow(j.imag[k],2));"function"==typeof d&&h&&d(e.get(i))},e.start=function(a){i=a,h=!0},e.stop=function(){h=!1},e.audioContext=a,e.get=function(a){if("object"==typeof a){for(var b={},c=0;c<a.length;c++)try{b[a[c]]=e.featureExtractors[a[c]](f,e)}catch(d){console.error(d)}return b}if("string"==typeof a)return e.featureExtractors[a](f,e);throw"Invalid Feature Format"},g.connect(window.spn,0,0),e;throw"undefined"==typeof a?"AudioContext wasn't specified: Meyda will not run.":"Buffer size is not a power of two: Meyda will not run."};